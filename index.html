<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Image Gallery</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Tailwind CSS CDN for styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React and ReactDOM CDNs -->
  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <!-- Babel CDN for JSX transpilation -->
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    function ImageGallery() {
      // Initialize state with images from localStorage, defaulting to an empty array
      const [images, setImages] = React.useState(() => {
        const saved = localStorage.getItem("galleryImages");
        return saved ? JSON.parse(saved) : [];
      });

      // Handle image uploads with a limit of 2 images and add a timestamp tracker
      const handleImageUpload = (event) => {
        const files = event.target.files;
        if (files && images.length < 2) {
          // Limit new uploads to the remaining capacity (2 - current length)
          const newImages = Array.from(files).slice(0, 2 - images.length);
          const newImageData = [];

          newImages.forEach((file) => {
            const reader = new FileReader();
            reader.onload = (e) => {
              // Add timestamp as a basic tracker for when the image was uploaded
              const timestamp = new Date().toISOString();
              newImageData.push({
                id: Date.now() + Math.random(), // Unique ID using timestamp + random number
                src: e.target.result,
                timestamp: timestamp
              });

              // Once all files are processed, update state and localStorage
              if (newImageData.length === newImages.length) {
                const updatedImages = [...images, ...newImageData];
                setImages(updatedImages);
                try {
                  localStorage.setItem("galleryImages", JSON.stringify(updatedImages));
                } catch (error) {
                  if (error.name === "QuotaExceededError") {
                    alert("Storage limit reached. Cannot save more images. Try deleting some.");
                  } else {
                    console.error("Error saving to local storage:", error);
                  }
                }
              }
            };
            reader.readAsDataURL(file);
          });
        } else if (images.length >= 2) {
          alert("Maximum of 2 images reached. Delete some to add more.");
        }
      };

      // Handle image deletion
      const handleDeleteImage = (imageId) => {
        const updatedImages = images.filter((img) => img.id !== imageId);
        setImages(updatedImages);
        // Update localStorage with the new image array
        localStorage.setItem("galleryImages", JSON.stringify(updatedImages));
      };

      // Render the gallery UI
      return (
        <div className="container mx-auto p-4">
          <h1 className="text-2xl font-bold mb-4">Image Gallery</h1>
          <input
            type="file"
            accept="image/*"
            multiple
            onChange={handleImageUpload}
            className="mb-4"
          />
          {images.length > 0 ? (
            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
              {images.map((image) => (
                <div key={image.id} className="relative">
                  <img
                    src={image.src}
                    alt="Gallery Image"
                    className="w-full h-auto rounded-lg shadow"
                  />
                  <p className="text-xs text-gray-500 mt-1">
                    Uploaded: {new Date(image.timestamp).toLocaleString()}
                  </p>
                  <button
                    className="absolute top-2 right-2 px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600 text-sm"
                    onClick={() => handleDeleteImage(image.id)}
                  >
                    Delete
                  </button>
                </div>
              ))}
            </div>
          ) : (
            <p className="text-sm text-gray-700">No images uploaded yet.</p>
          )}
        </div>
      );
    }

    // Render the ImageGallery component to the root div
    ReactDOM.render(<ImageGallery />, document.getElementById('root'));
  </script>
</body>
</html>
